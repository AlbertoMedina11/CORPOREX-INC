var _ = require('lodash');

Function.prototype.dotry = function (done, autoDone) {
  var thisFn = this;

  if (!('doTryCall' in done)) {
    done.doTryCall = _.once(done);
  }

  return function () {
    try {
      var res = thisFn.apply(this, arguments);

      if (autoDone) {
        done.doTryCall(null, res);
      }
    }
    catch (e) {
      done.doTryCall(e);
    }
  }
};
